function DependencySet(){this.elements=[],this.add=function(a){for(var b=0;b<this.elements.length;++b)if(this.elements[b].equals(a))return;this.elements.push(a)},this.addAll=function(a){for(var b=0;b<a.elements.length;++b)this.add(new FunctionalDependency(a.elements[b].lhs.copy(),a.elements[b].rhs.copy()))},this.remove=function(a){for(var b=0;b<this.elements.length;++b)if(this.elements[b].equals(a))return void this.elements.splice(b,1)},this.removeRedundantLeftHandAttributes=function(a){for(var b=0;b<a.copy().elements.length;++b){var c=a.elements[b];if(c.lhs.length>1)for(var d=c.lhs.copy(),e=0;e<d.length;++e){var f=d[e],g=c.lhs.copy();g.remove(f);var h=new FunctionalDependency(g,c.rhs),i=a.copy();if(i.remove(c),i.add(h),i.equals(a))return a.remove(c),a.add(h),console.log("REPLACE: "+c+" with "+h.lhs+"->"+h.rhs),1}}return 0},this.minCover=function(a){for(var b=null,c=new DependencySet,d=0;d<this.elements.length;++d){var e=this.elements[d];if(e.isTrivial());else if(1==e.rhs.length)c.add(new FunctionalDependency(e.lhs,e.rhs));else for(var f=0;f<e.rhs.length;++f){var g=e.rhs,h=new FunctionalDependency(e.lhs,g.copy());h.isTrivial()||c.add(h)}}for(b=c,a&&(a.singleRightHandSides=c);this.removeRedundantLeftHandAttributes(b)>0;);a&&(a.removedLHSAttributes=b.copy());for(var i=0;i<b.copy().elements.length;++i){var j=b.copy().elements[i];b.remove(j),j.lhs.closure(b).containsAll(j.rhs)||b.add(j)}var k=b;return a&&(a.removedRedundantDependencies=b.copy()),k},this.attributeSet=function(){for(var a=[],b=0;b<this.elements.length;++b)a=a.concat(this.elements[b].lhs.set()),a=a.concat(this.elements[b].rhs.set());return a.set()},this.copy=function(){var a=new DependencySet;return a.addAll(this),a},this.isEmpty=function(){return 0===this.elements.length},this.equals=function(a){for(var b=0;b<this.elements.length;++b){var c=this.elements[b],d=c.lhs.closure(a);if(!d.containsAll(c.rhs))return!1}for(var e=0;e<this.elements.length;++e){var f=this.elements[e],g=f.lhs.closure(this);if(!g.containsAll(f.rhs))return!1}return!0},this.clear=function(){this.elements=[]},this.print=function(){for(var a=0;a<this.elements.length;++a)this.elements[a].print()}}function FunctionalDependency(a,b){this.lhs=a.copy(),this.rhs=b.copy(),this.getAttributeSet=function(){var c=a.concat(b);return c.sort().filter(function(a,b){return!b||a!=c[b-1]})},this.isTrivial=function(){return 0===b.length?!0:a.containsAll(b)},this.equals=function(a){if(this.lhs.length!==a.lhs.length||this.rhs.length!==a.rhs.length)return!1;for(var b=0;b<this.lhs.length;++b)if(this.lhs[b]!=a.lhs[b])return!1;for(var c=0;c<this.rhs.length;++c)if(this.rhs[c]!=a.rhs[c])return!1;return!0},this.toString=function(){return this.lhs.join(", ")+" â†’ "+this.rhs.join(", ")},this.print=function(){console.log(this)}}function Relation(a){this.attributes=[],this.primaryKey=[],this.constructWithFunctionalDependency=function(a){null===a&&console.log("ERROR: Cannot create table out of null dependency"),(a.lhs.isEmpty()||a.rhs.isEmpty())&&console.log("ERROR: Cannot create table out of empty dependency"),this.attributes=[],this.attributes=this.attributes.concat(a.lhs),this.attributes=this.attributes.concat(a.rhs),this.primaryKey=[],this.primaryKey=this.primaryKey.concat(a.lhs)},this.constructWithAttributes=function(a){var b=a.copy();null===a&&console.log("ERROR: Attribute set cannot be null"),a.isEmpty()&&console.log("ERROR: EMPTY ATTRITBUTE SET"),null===b||a.containsAll(b)||console.log("ERROR: PRIMARY KEY MUST BE A SUBSET OF THE ATTRIBUTES"),this.attributes=[],this.attributes=this.attributes.concat(a),null!==b&&(this.primaryKey=[],this.primaryKey=this.primaryKey.concat(b))},this.containsAll=function(a){return this.attributes.containsAll(a.attributes)},this.toString=function(){for(var a="[",b=[],c=0;c<this.attributes.length;++c){var d=this.attributes[c];this.primaryKey.indexOf(d)>=0&&b.push(d)}a+=b.join(", ");for(var e=[],f=0;f<this.attributes.length;++f){var g=this.attributes[f];this.primaryKey.indexOf(g)<0&&e.push(g)}return e.length>0&&(a+=" | "),a+=e.join(", "),a+="]"},a.constructor===Array?this.constructWithAttributes(a):this.constructWithFunctionalDependency(a)}Array.prototype.set=function(){var a=this;return this.sort().filter(function(b,c){return!c||JSON.stringify(b)!=JSON.stringify(a[c-1])})},Array.prototype.containsAll=function(a){for(var b=[],c=0;c<a.length;++c)this.indexOf(a[c])>-1&&b.push(a[c]);return b.length===a.length},Array.prototype.copy=function(){return this.slice()},Array.prototype.equals=function(a){if(!a)return!1;if(this.length!=a.length)return!1;for(var b=0,c=this.length;c>b;b++)if(this[b]instanceof Array&&a[b]instanceof Array){if(!this[b].equals(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.isEmpty=function(){return 0===this.length},Array.prototype.remove=function(a){var b=this.indexOf(a);b>-1&&this.splice(b,1)},Array.prototype.closure=function(a){for(var b=[],c=this.copy();!c.equals(b);){b=c.copy(),c=c.copy();for(var d=0;d<a.elements.length;++d){var e=a.elements[d];c.containsAll(e.lhs)&&(c=c.concat(e.rhs).set())}}return c},Array.prototype.findCandidateKey=function(a){for(var b=this.copy(),c=0;c<this.length;++c){var d=this[c],e=b.copy();e.remove(d),e.closure(a).containsAll(this)&&(b=e)}return b},Array.prototype.allCandidateKeys=function(a){var b=10,c=[],d=this.copy();return c.push(d),this.length<=b?this.candidateKeys(c,a):(Console.log("WARNING: Too many attributes to find all possible keys, RETURNING NULL"),null)},Array.prototype.candidateKeys=function(a,b){if(a.isEmpty())return a;var c=a[0];if(a.remove(c),1==c.length){var d=[];return d.push(c),d=d.concat(d(a,b))}for(var e=c.copy(),f=[],g=0;g<e.length;++g){var h=e[g],i=c.copy();i.remove(h),i.closure(b).containsAll(this)&&f.push(i)}if(f.isEmpty()){var j=[];return j.push(c),j=j.concat(this.candidateKeys(a,b))}for(var k=[],l=0;l<f.length;++l){var m=f[l],n=[];n.push(m),k=k.concat(this.candidateKeys(n,b))}return k=k.concat(this.candidateKeys(a,b))};var parseInput=function(a){a=a.split("\n");for(var b=new DependencySet,c=0;c<a.length;++c){var d=a[c],e=d.indexOf("->");if(e>=0){for(var f=d.substring(0,e).trim().split(","),g=d.substring(e+2,d.length).trim().split(","),h=0;h<f.length;++h)f[h]=f[h].trim();for(var i=0;i<g.length;++i)g[i]=g[i].trim();if(f.length>0&&g.length>0){var j=new FunctionalDependency(f,g);b.add(j)}}}return b};angular.module("dbNormalizer",[]).controller("appController",["$scope",function(a){a.rawInput="SSN -> Salary\nSSN -> Phone\nSSN -> Dno\nPno -> Pname\nPno -> Plocation\nSSN,Pno -> Salary\nSSN,Pno -> Phone\nSSN,Pno -> Dno\nSSN,Pno -> Pname\nSSN,Pno -> Plocation",a.functionalDependencies=null,a.singleRightHandSides=null,a.removedLHSAttributes=null,a.removedRedundantDependencies=null,a.minCover=null,a.minCoverMergedLHS=null,a.candidateKey=null,a.allCandidateKeys=null,a.dependencyPreserving3NFTables=null,a.losslessJoinDependencyPreserving3NFTables=null,a.normalize=function(){a.reset(),document.getElementById("results").style.display="block",document.getElementById("noResults").style.display="none";var b=a.rawInput;a.functionalDependencies=parseInput(b),a.minCover=a.functionalDependencies.minCover(a),a.minCoverMergedLHS=a.minCover.copy();for(var c=a.minCoverMergedLHS.copy(),d=new DependencySet;!c.isEmpty();){var e=c.elements[0];c.remove(e),a.minCoverMergedLHS.remove(e),d.add(e);for(var f=0;f<c.elements.length;++f){var g=c.elements[f];e.lhs.equals(g.lhs)&&(e.rhs=e.rhs.concat(g.rhs),a.minCoverMergedLHS.remove(g))}c=a.minCoverMergedLHS.copy()}a.minCoverMergedLHS=d;var h=a.functionalDependencies.attributeSet(),i=h.findCandidateKey(a.minCoverMergedLHS);a.candidateKey=i;var j=h.allCandidateKeys(a.minCoverMergedLHS);a.allCandidateKeys=j.set();for(var k=[],l=0;l<a.minCoverMergedLHS.elements.length;++l){var m=a.minCoverMergedLHS.elements[l],n=new Relation(m);k.push(n)}for(var o=a.minCoverMergedLHS.attributeSet(),p=[],q=0;q<h.length;++q){var r=h[q];o.indexOf(r)<0&&p.push(r)}if(!p.isEmpty()){var s=new Relation(p,p);k.push(s)}a.dependencyPreserving3NFTables=k;for(var t=function(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<a.length;++d){var e=a[d];if(c!=e&&e.containsAll(c))return c}return null},u=[],v=0;v<a.minCoverMergedLHS.elements.length;++v){var w=a.minCoverMergedLHS.elements[v],x=new Relation(w);u.push(x)}for(var y=!1,z=0;z<u.length;++z){var A=u[z],B=A.attributes.set();if(B.containsAll(i)){y=!0;break}}y||u.push(new Relation(i,i));for(var C=null;null!==(C=t(u));)u.remove(C),console.log("Removing Redundant table: "+C);a.losslessJoinDependencyPreserving3NFTables=u},a.reset=function(){a.functionalDependencies=null,a.minCover=null,a.singleRightHandSides=null}}]);